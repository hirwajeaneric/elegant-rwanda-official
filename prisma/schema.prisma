// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model NewsletterSubscriber {
  id        String   @id @default(cuid())
  email     String   @unique
  firstName String?
  source    String?  // Where they subscribed from (footer, events, blog, etc.)
  preferences Json?  // Store preferences as JSON for events newsletter
  subscribedAt DateTime @default(now())
  updatedAt   DateTime @updatedAt
  active      Boolean  @default(true)

  @@index([email])
  @@index([source])
  @@index([subscribedAt])
}

// Legacy: kept for existing data only; new submissions use typed booking models only
model Request {
  id        String        @id @default(cuid())
  type      RequestType
  status    RequestStatus @default(PENDING)
  data      Json?
  userEmail String?
  userName  String?
  tourId    String?
  tour      Tour?         @relation(fields: [tourId], references: [id], onDelete: SetNull)
  eventId   String?
  event     Event?        @relation(fields: [eventId], references: [id], onDelete: SetNull)
  vehicleId String?
  vehicle   Vehicle?      @relation(fields: [vehicleId], references: [id], onDelete: SetNull)
  createdAt DateTime      @default(now())
  updatedAt DateTime      @updatedAt

  @@index([type])
  @@index([status])
  @@index([userEmail])
  @@index([tourId])
  @@index([eventId])
  @@index([vehicleId])
  @@index([createdAt])
}

enum BookingStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  ARCHIVED
}

// Standalone booking models: each service has its own table, no Request linkage
model CabBooking {
  id               String        @id @default(cuid())
  status           BookingStatus @default(PENDING)
  serviceType      String
  vehicleType      String
  pickupLocation   String
  dropoffLocation  String
  pickupDate       String
  pickupTime       String
  passengers       String
  luggage          String?
  specialRequests  String?
  name             String
  phone            String
  email            String
  preferredContact String?
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt

  @@index([status])
  @@index([createdAt])
}

model TourBooking {
  id              String        @id @default(cuid())
  status          BookingStatus @default(PENDING)
  tourId          String?
  tour            Tour?         @relation(fields: [tourId], references: [id], onDelete: SetNull)
  numberOfPeople  Int
  preferredStart  String?
  specialRequests String?
  name            String
  email           String
  phone           String
  country         String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt

  @@index([status])
  @@index([tourId])
  @@index([createdAt])
}

model CarRentalBooking {
  id                   String        @id @default(cuid())
  status               BookingStatus @default(PENDING)
  vehicleId            String?
  vehicle              Vehicle?      @relation(fields: [vehicleId], references: [id], onDelete: SetNull)
  startDate            String
  endDate              String
  rentalType           String?
  name                 String
  email                String
  phone                String
  specialRequests      String?
  driverName           String?
  driverLicense        String?
  driverLicenseExpiry   String?
  pickupLocation       String?
  dropoffLocation      String?
  passengers           Int?
  createdAt            DateTime      @default(now())
  updatedAt            DateTime      @updatedAt

  @@index([status])
  @@index([vehicleId])
  @@index([createdAt])
}

model EventRegistration {
  id                    String        @id @default(cuid())
  status                BookingStatus @default(PENDING)
  eventId               String?
  event                 Event?        @relation(fields: [eventId], references: [id], onDelete: SetNull)
  numberOfParticipants  Int           @default(1)
  name                  String
  email                 String
  phone                 String
  organization          String?
  specialRequests       String?
  dietaryRestrictions   String?
  createdAt             DateTime      @default(now())
  updatedAt             DateTime      @updatedAt

  @@index([status])
  @@index([eventId])
  @@index([createdAt])
}

model ContactInquiry {
  id          String   @id @default(cuid())
  name        String
  email       String
  phone       String?
  subject     String
  message     String
  serviceType String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([createdAt])
}

// Singleton: one row (id = "default") for site-wide contact, hours, social links
model WebsiteSettings {
  id             String   @id @default("default")
  siteName       String?
  tagline        String?
  address        String?
  phonePrimary   String?
  phoneSecondary String?
  emailPrimary   String?
  emailSecondary String?
  businessHours  String?  // free text, e.g. "Mon–Fri 8am–6pm"
  emergencyPhone String?
  emergencyNote  String?
  socialLinks    Json?    // [{ platform, label, url }]
  updatedAt      DateTime @updatedAt
}

// Singleton: one row (id = "default") for About page editable content
model AboutPageContent {
  id                   String   @id @default("default")
  historicalBackground String   @default("") // HTML or plain text
  quickFacts           Json     @default("[]") // [{ label, value }]
  missionValues        Json     @default("[]") // [{ title, description }]
  updatedAt            DateTime @updatedAt
}

model AirTravelRequest {
  id                   String   @id @default(cuid())
  tripType             String?
  origin               String?
  destination          String?
  departureDate        String?
  departureTime        String?
  returnDate           String?
  returnTime           String?
  travelClass          String?
  services             Json?    // ["Visa Assistance", "Airport Pickup", ...]
  passengersAdults     Int?
  passengersChildren  Int?
  passengersInfants   Int?
  primaryTravelerName String?
  nationality         String?
  passportNumber      String?
  passportExpiry      String?
  luggageCheckedBags   Int?
  luggageCabinBags    Int?
  luggageSpecialItems String?
  seatPreference      String?
  loyaltyProgram      String?
  budgetRange         String?
  preferences         String?
  name                String
  email               String
  phone               String
  country             String?
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@index([createdAt])
}

enum RequestType {
  AIR_TRAVEL
  CAB_BOOKING
  CAR_RENTAL
  TOUR_BOOKING
  CONTACT
  INQUIRY
  EVENT_REGISTRATION
  EVENTS_NEWSLETTER
}

enum RequestStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  ARCHIVED
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String
  password      String    // Hashed password
  role          UserRole  @default(EDITOR)
  active        Boolean   @default(true)
  emailVerified Boolean   @default(false)
  lastLogin     DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  createdBy     String?   // ID of user who created this account
  updatedBy     String?   // ID of user who last updated this account
  sessions      Session[] // User sessions
  passwordResetTokens PasswordResetToken[] // Password reset tokens
  otpVerifications    OTPVerification[]    // OTP verifications
  images        Image[]  // Images uploaded by user
  categoriesCreated Category[] @relation("CategoryCreatedBy")
  categoriesUpdated Category[] @relation("CategoryUpdatedBy")
  blogsCreated  Blog[]   @relation("BlogCreatedBy")
  blogsUpdated  Blog[]   @relation("BlogUpdatedBy")
  faqsCreated   FAQ[]    @relation("FAQCreatedBy")
  faqsUpdated   FAQ[]    @relation("FAQUpdatedBy")
  teamsCreated  Team[]   @relation("TeamCreatedBy")
  teamsUpdated  Team[]   @relation("TeamUpdatedBy")

  @@index([email])
  @@index([role])
  @@index([active])
  @@index([createdAt])
}

model Session {
  id            String   @id @default(cuid())
  userId        String
  token         String   @unique
  refreshToken  String?  @unique
  ipAddress     String?
  userAgent     String?
  device        String?  // Device type (mobile, desktop, tablet)
  browser       String?  // Browser name
  browserVersion String?
  os            String?  // Operating system
  osVersion     String?
  platform      String?  // Platform (web, ios, android)
  country       String?  // Country code
  city          String?  // City name
  region        String?  // Region/state
  timezone      String?  // Timezone
  isActive      Boolean  @default(true)
  expiresAt     DateTime
  lastActivity  DateTime  @default(now())
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@index([refreshToken])
  @@index([isActive])
  @@index([expiresAt])
  @@index([createdAt])
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  userId    String
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([token])
  @@index([expiresAt])
  @@index([used])
}

model OTPVerification {
  id        String   @id @default(cuid())
  userId    String?  // null for registration, set after user creation
  email     String
  otp       String
  purpose   OTPPurpose
  expiresAt DateTime
  verified  Boolean  @default(false)
  attempts  Int      @default(0)
  createdAt DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([otp])
  @@index([expiresAt])
  @@index([verified])
  @@index([purpose])
}

enum UserRole {
  ADMIN
  CONTENT_MANAGER
  EDITOR
}

enum OTPPurpose {
  REGISTRATION
  PASSWORD_RESET
  EMAIL_VERIFICATION
}

model Image {
  id          String   @id @default(cuid())
  publicId   String   @unique // Cloudinary public_id
  url        String   // Cloudinary secure URL
  urlRaw     String?  // Raw URL without transformations
  title      String?
  alt        String?
  description String?
  category   String?  // Category name (Wildlife, Landscapes, etc.) - legacy field
  categoryId String?  // Reference to Category model
  categoryRef Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  folder     String?  // Cloudinary folder path
  width      Int?
  height     Int?
  format     String?  // jpg, png, webp, etc.
  bytes      Int?     // File size in bytes
  tags       String[] // Array of tags
  featured   Boolean  @default(false)
  active     Boolean  @default(true)
  uploadedBy String?  // User ID who uploaded
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  user       User?    @relation(fields: [uploadedBy], references: [id], onDelete: SetNull)

  @@index([category])
  @@index([categoryId])
  @@index([active])
  @@index([featured])
  @@index([uploadedBy])
  @@index([createdAt])
  @@index([publicId])
}

model Category {
  id          String   @id @default(cuid())
  name        String
  slug        String   @unique
  description String?
  type        CategoryType[] // Array of category types
  color       String?
  icon        String?
  order       Int      @default(0)
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdBy   String?
  updatedBy   String?
  createdByUser User?  @relation("CategoryCreatedBy", fields: [createdBy], references: [id], onDelete: SetNull)
  updatedByUser User?  @relation("CategoryUpdatedBy", fields: [updatedBy], references: [id], onDelete: SetNull)
  blogs       Blog[]
  faqs        FAQ[]
  images      Image[]
  tours       Tour[]
  events      Event[]

  @@index([slug])
  @@index([active])
  @@index([order])
  @@index([createdAt])
}

enum CategoryType {
  FAQ
  BLOG
  EVENT
  TOUR
  IMAGE
  GENERAL
}

model Blog {
  id              String   @id @default(cuid())
  title           String
  slug            String   @unique
  excerpt         String
  content         String   // HTML content
  author          String
  authorImage     String?
  publishDate     DateTime?
  readTime        String   @default("5 min")
  categoryId      String?
  category        Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  tags            String[]
  featuredImage   String?
  featured        Boolean  @default(false)
  metaTitle       String?
  metaDescription String?
  status          BlogStatus @default(DRAFT)
  views           Int      @default(0)
  comments        Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  createdBy       String?
  updatedBy       String?
  createdByUser   User?    @relation("BlogCreatedBy", fields: [createdBy], references: [id], onDelete: SetNull)
  updatedByUser   User?    @relation("BlogUpdatedBy", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@index([slug])
  @@index([status])
  @@index([featured])
  @@index([categoryId])
  @@index([publishDate])
  @@index([createdAt])
}

enum BlogStatus {
  PUBLISHED
  DRAFT
  SCHEDULED
}

model FAQ {
  id          String   @id @default(cuid())
  question    String
  answer      String   // HTML content
  categoryId  String?
  category    Category? @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  order       Int      @default(0)
  active      Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  createdBy   String?
  updatedBy   String?
  createdByUser User?  @relation("FAQCreatedBy", fields: [createdBy], references: [id], onDelete: SetNull)
  updatedByUser User?  @relation("FAQUpdatedBy", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@index([categoryId])
  @@index([active])
  @@index([order])
  @@index([createdAt])
}

model Team {
  id            String   @id @default(cuid())
  name          String
  role          String
  bio           String
  image         String?
  status        TeamStatus @default(ACTIVE)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  createdBy     String?
  updatedBy     String?
  createdByUser User?    @relation("TeamCreatedBy", fields: [createdBy], references: [id], onDelete: SetNull)
  updatedByUser User?    @relation("TeamUpdatedBy", fields: [updatedBy], references: [id], onDelete: SetNull)

  @@index([status])
  @@index([createdAt])
}

enum TeamStatus {
  ACTIVE
  INACTIVE
}

model Testimonial {
  id              String   @id @default(cuid())
  name            String   // Customer name
  location        String?  // Customer location
  rating          Int      @default(5) // 1-5
  review          String   // Main review text
  service         String   // Tour | Cab Booking | Car Rental | Air Travel Assistance | Event
  image           String?  // URL to customer image
  active          Boolean  @default(true) // Toggle: show (active) or hide (inactive)
  metaTitle       String?
  metaDescription String?
  title           String?
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
  createdBy       String?
  updatedBy       String?

  @@index([active])
  @@index([service])
  @@index([createdAt])
}

enum EventStatus {
  Open
  Filling_Fast
  Waitlist
  Closed
}

model Event {
  id                    String         @id @default(cuid())
  slug                  String         @unique
  title                 String
  description           String
  metaTitle             String?
  metaDescription       String?
  date                  DateTime
  endDate               DateTime?
  location              String
  maxParticipants       Int
  currentParticipants   Int             @default(0)
  categoryId            String?
  category              Category?       @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  highlights            String[]
  activities            String[]
  images                String[]
  featured              Boolean         @default(false)
  registrationDeadline  DateTime
  status                EventStatus     @default(Open)
  time                  String          // e.g. "08:00 AM"
  price                 Float
  active                Boolean         @default(true)
  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt

  requests              Request[]
  eventRegistrations    EventRegistration[]

  @@index([slug])
  @@index([status])
  @@index([categoryId])
  @@index([date])
  @@index([active])
  @@index([createdAt])
}

enum VehicleCategory {
  Economy
  Compact
  SUV
  Unique
  Minivan
  Adventure
  Executive
}

enum VehicleStatus {
  available
  rented
  maintenance
}

model Vehicle {
  id                 String          @id @default(cuid())
  slug               String         @unique
  name               String
  category           VehicleCategory
  description        String         // HTML content (rich text)
  shortDescription   String
  images             String[]
  specifications     Json           // passengers, doors, transmission, fuelType, engineSize, power, fuelEfficiency, luggageCapacity, airConditioning, bluetooth, navigation, cruiseControl, parkingSensors, backupCamera, usbPorts, wifi
  available          Boolean        @default(true)
  pickupLocations    String[]
  includedServices   String[]
  additionalServices String[]
  requirements       String[]
  insurance          Json           // { included, coverage, excess }
  make               String
  model              String
  year               Int
  plateNumber        String
  dailyRate          Float
  status             VehicleStatus  @default(available)
  location           String
  mileage            Int            @default(0)
  lastService        String?        // date string
  nextService        String?
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt

  requests           Request[]
  carRentalBookings  CarRentalBooking[]

  @@index([slug])
  @@index([category])
  @@index([status])
  @@index([available])
  @@index([createdAt])
}

enum TourDifficulty {
  Easy
  Moderate
  Challenging
}

enum TourStatus {
  active
  draft
  scheduled
}

model Tour {
  id              String         @id @default(cuid())
  slug            String         @unique
  title           String
  description     String         // HTML content (rich text)
  duration        String
  location        String
  difficulty      TourDifficulty
  maxGroupSize    Int
  highlights      String[]
  itinerary       Json           // Array of Day objects: { day, title, description, activities[], accommodation?, meals[] }
  inclusions      String[]
  exclusions      String[]
  images          String[]
  categoryId      String?
  category        Category?      @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  featured        Boolean        @default(false)
  availableDates  String[]
  price           Float?
  status          TourStatus     @default(draft)
  bookings        Int            @default(0)
  capacity        Int
  guide           String?
  rating          Float?
  reviews         Int            @default(0)
  metaTitle       String?
  metaDescription String?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  requests        Request[]
  tourBookings    TourBooking[]

  @@index([slug])
  @@index([categoryId])
  @@index([status])
  @@index([featured])
  @@index([createdAt])
}
